<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bol√£o Amigo Secreto - App Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #2D1B4E; color: #F5F5F5; }
        h1, h2, h3, .font-display { font-family: 'Fredoka One', cursive; }
        
        /* Anima√ß√µes e Utilit√°rios */
        .page-enter { animation: slideIn 0.4s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        details > summary { list-style: none; cursor: pointer; transition: all 0.2s; }
        details > summary::-webkit-details-marker { display: none; }
        .rotate-icon { transition: transform 0.3s; }
        details[open] .rotate-icon { transform: rotate(180deg); }

        .input-dark {
            width: 100%; padding: 1rem; border-radius: 0.75rem;
            background-color: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; outline: none; transition: all 0.3s;
        }
        .input-dark:focus { border-color: #FACC15; background-color: rgba(255,255,255,0.15); }
    </style>
</head>
<body class="bg-[#2D1B4E] min-h-screen pb-10">

    <div id="painel-admin" class="hidden fixed top-0 right-0 p-2 z-50 opacity-90">
        <div class="bg-gray-800 p-2 rounded-lg text-xs shadow-xl border border-gray-600 flex flex-col gap-1">
            <p class="mb-1 text-gray-400 font-bold text-center">SIMULADOR</p>
            <button onclick="mudarFase('PALPITES')" class="bg-blue-600 px-2 py-1 rounded text-white hover:bg-blue-500">Liberar Palpites</button>
            <button onclick="mudarFase('BLOQUEADO')" class="bg-red-600 px-2 py-1 rounded text-white hover:bg-red-500">Bloquear (1h antes)</button>
            <button onclick="calcularResultado()" class="bg-yellow-600 px-2 py-1 rounded text-white hover:bg-yellow-500">Revelar Resultado</button>
        </div>
    </div>

    <div id="tela-home" class="min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <div class="text-center mb-10">
            <div class="inline-block bg-yellow-400 p-5 rounded-full mb-4 shadow-[0_0_30px_rgba(250,204,21,0.4)]">
                <i class="fa-solid fa-gift text-4xl text-purple-900"></i>
            </div>
            <h1 class="text-4xl text-yellow-400 mb-2 font-display">Bol√£o Secreto</h1>
            <p class="text-gray-300">Crie sua sala, convide a turma e descubra quem tirou quem!</p>
        </div>

        <div class="w-full max-w-sm space-y-4">
            <button onclick="trocarTela('tela-home', 'tela-criar')" class="w-full bg-yellow-400 hover:bg-yellow-300 text-purple-900 font-bold text-xl py-4 rounded-2xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-3">
                <i class="fa-solid fa-plus-circle"></i> CRIAR EVENTO
            </button>
            <button onclick="trocarTela('tela-home', 'tela-entrar')" class="w-full bg-indigo-800 hover:bg-indigo-700 text-white font-bold text-xl py-4 rounded-2xl shadow-lg border border-indigo-600 transition-transform active:scale-95 flex items-center justify-center gap-3">
                <i class="fa-solid fa-ticket"></i> TENHO C√ìDIGO
            </button>
        </div>
    </div>

    <div id="tela-criar" class="hidden min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <h2 class="text-2xl text-yellow-400 font-display mb-6">Configurar Evento</h2>
        <div class="w-full max-w-sm bg-white/5 p-6 rounded-3xl border border-white/10 space-y-4">
            <div>
                <label class="text-xs text-gray-400 ml-1 uppercase font-bold">Nome do Evento</label>
                <input type="text" id="confNomeEvento" placeholder="Ex: Natal da Fam√≠lia" class="input-dark">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-gray-400 ml-1 uppercase font-bold">Participantes</label>
                    <input type="number" id="confQtd" value="10" class="input-dark text-center">
                </div>
                <div>
                    <label class="text-xs text-gray-400 ml-1 uppercase font-bold">Valor (R$)</label>
                    <input type="number" id="confValor" value="10" class="input-dark text-center">
                </div>
            </div>
            <div>
                <label class="text-xs text-gray-400 ml-1 uppercase font-bold">Chave Pix</label>
                <input type="text" id="confPix" placeholder="Para pagamento do pr√™mio" class="input-dark">
            </div>
            <button onclick="gerarSala()" class="w-full bg-green-500 hover:bg-green-400 text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-all">GERAR SALA üé≤</button>
            <button onclick="voltarHome()" class="w-full text-gray-400 text-sm py-2 hover:text-white">Voltar</button>
        </div>
    </div>

    <div id="tela-entrar" class="hidden min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <h2 class="text-2xl text-yellow-400 font-display mb-6">Entrar no Bol√£o</h2>
        <div class="w-full max-w-sm bg-white/5 p-6 rounded-3xl border border-white/10 space-y-4">
            <div>
                <label class="text-xs text-gray-400 ml-1 uppercase font-bold">C√≥digo da Sala</label>
                <input type="text" id="inputCodigoSala" placeholder="Ex: NATAL" class="input-dark text-center uppercase text-2xl tracking-widest font-display">
            </div>
            <div>
                <label class="text-xs text-gray-400 ml-1 uppercase font-bold">Seu Nome</label>
                <input type="text" id="inputNomeParticipante" placeholder="Seu nome" class="input-dark">
            </div>
            <button onclick="acessarSala()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-all">ENTRAR üöÄ</button>
            <button onclick="voltarHome()" class="w-full text-gray-400 text-sm py-2 hover:text-white">Voltar</button>
        </div>
    </div>

    <div id="tela-jogo" class="hidden max-w-md mx-auto p-4 page-enter">
        <div class="bg-indigo-900/50 p-4 rounded-2xl mb-4 border border-indigo-500/30">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h3 id="displayNomeEvento" class="font-bold text-lg text-white">Evento...</h3>
                    <p class="text-xs text-gray-400">C√≥digo: <span id="displayCodigo" class="text-yellow-400 font-bold bg-white/10 px-2 py-0.5 rounded ml-1 select-all cursor-pointer">...</span></p>
                </div>
                <div class="text-right">
                    <div class="text-green-400 font-bold text-xl" id="displayPremio">R$ 0</div>
                    <div class="text-[10px] text-gray-400 uppercase">Pr√™mio Total</div>
                </div>
            </div>
            <button onclick="copiarPix()" class="w-full bg-gray-800 hover:bg-gray-700 py-2 rounded-lg text-xs flex items-center justify-center gap-2 text-gray-300 transition-colors"><i class="fa-brands fa-pix"></i> Copiar Chave Pix</button>
        </div>

        <div id="barra-status" class="bg-green-500/20 text-green-400 text-center text-sm py-2 rounded-lg mb-4 border border-green-500/30 font-bold">
            üü¢ Palpites Liberados ‚Ä¢ Edite √† vontade
        </div>

        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-3">
                <div id="meuAvatar" class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-purple-900 font-bold shadow-lg">EU</div>
                <div>
                    <p class="text-xs text-gray-400">Jogador</p>
                    <p id="nomeUsuario" class="font-bold text-white leading-none">...</p>
                </div>
            </div>
            <div class="bg-indigo-950 border border-indigo-800 px-3 py-1 rounded-lg text-right">
                <p class="text-[10px] text-gray-400 uppercase tracking-wider">Faltam</p>
                <p id="contadorPalpites" class="font-display text-yellow-400 text-xl">10</p>
            </div>
        </div>

        <div id="lista-participantes" class="space-y-3 pb-24"></div>

        <div class="fixed bottom-0 left-0 w-full p-4 bg-gradient-to-t from-[#2D1B4E] via-[#2D1B4E] to-transparent pointer-events-none">
            <div class="max-w-md mx-auto pointer-events-auto">
                <button id="btnConfirmar" disabled class="w-full bg-gray-600 text-gray-300 font-bold py-4 rounded-xl shadow-lg transition-all text-lg opacity-80 cursor-not-allowed">
                    Complete os palpites...
                </button>
            </div>
        </div>
    </div>

    <div id="tela-ranking" class="hidden max-w-md mx-auto p-4 pb-20">
        <div class="text-center mb-6 mt-4">
            <h2 class="text-3xl font-display text-yellow-400 mb-1">Resultado Final</h2>
            <p class="text-gray-300 text-sm">Toque nos nomes para ver a <span class="text-yellow-400 font-bold">corre√ß√£o da prova</span></p>
        </div>
        <div id="podio-area" class="flex justify-center items-end gap-2 mb-8 h-40"></div>
        <div id="lista-ranking" class="space-y-3"></div>
        <button onclick="location.reload()" class="mt-8 w-full py-4 rounded-xl border border-white/20 text-gray-400 hover:bg-white/5">Sair / Novo Jogo</button>
    </div>

    <div id="modal-selecao" class="fixed inset-0 bg-black/80 hidden z-50 flex items-end justify-center">
        <div class="bg-gray-900 w-full max-w-md rounded-t-3xl p-6 animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Quem ele(a) tirou?</h3>
                <button onclick="fecharModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="grid-opcoes" class="grid grid-cols-4 gap-4"></div>
        </div>
    </div>

    <script>
        // --- ESTADO GLOBAL ---
        let appConfig = { salaId: null, nomeEvento: "", qtdParticipantes: 10, valorEntrada: 10, chavePix: "", usuarioNome: "" };
        let estadoJogo = {
            fase: 'PALPITES', // PALPITES, BLOQUEADO, REVELADO
            palpitesUsuario: {},
            participantes: [], // Ser√° preenchido ao iniciar
            gabaritoReal: {} // Ser√° gerado na hora
        };
        let idSelecionadoAtual = null;

        // --- DADOS MOCK (NOMES PARA PREENCHER) ---
        const nomesMock = ["Ana", "Bruno", "Carla", "Daniel", "Elisa", "F√°bio", "Gabi", "Hugo", "In√™s", "Jo√£o", "Lucas", "Mari"];
        const avataresMock = ["üë©üèª", "üë±üèª‚Äç‚ôÇÔ∏è", "üë©üèΩ", "üßîüèª", "üë©üèº", "üë®üèø", "üë©üèª‚Äçü¶∞", "üë®üèª‚Äçü¶≤", "üëµüèª", "üë±üèø‚Äç‚ôÇÔ∏è", "ü§ì", "üòé"];

        // --- NAVEGA√á√ÉO ---
        function trocarTela(atual, proxima) {
            document.getElementById(atual).classList.add('hidden');
            document.getElementById(proxima).classList.remove('hidden');
        }
        function voltarHome() {
            document.querySelectorAll('.page-enter').forEach(el => el.classList.add('hidden'));
            document.getElementById('tela-home').classList.remove('hidden');
        }

        // --- CRIA√á√ÉO E ENTRADA ---
        function gerarSala() {
            const nome = document.getElementById('confNomeEvento').value;
            const qtd = parseInt(document.getElementById('confQtd').value);
            const valor = parseFloat(document.getElementById('confValor').value);
            const pix = document.getElementById('confPix').value;

            if(!nome || !pix) return alert("Preencha os dados do evento!");

            appConfig = { salaId: Math.random().toString(36).substring(2, 7).toUpperCase(), nomeEvento: nome, qtdParticipantes: qtd, valorEntrada: valor, chavePix: pix, usuarioNome: "Organizador" };
            iniciarJogo();
        }

        function acessarSala() {
            const codigo = document.getElementById('inputCodigoSala').value;
            const nome = document.getElementById('inputNomeParticipante').value;
            if(!codigo || !nome) return alert("Preencha tudo!");

            appConfig.salaId = codigo.toUpperCase();
            appConfig.usuarioNome = nome;
            appConfig.nomeEvento = "Evento de Amigos"; // Simula√ß√£o
            appConfig.chavePix = "pix@exemplo.com";
            
            iniciarJogo();
        }

        // --- INICIALIZA√á√ÉO DO JOGO ---
        function iniciarJogo() {
            document.querySelectorAll('.page-enter').forEach(el => el.classList.add('hidden'));
            document.getElementById('tela-jogo').classList.remove('hidden');
            document.getElementById('painel-admin').classList.remove('hidden'); // MOSTRAR SIMULADOR

            // Preencher Header
            document.getElementById('displayNomeEvento').innerText = appConfig.nomeEvento;
            document.getElementById('displayCodigo').innerText = appConfig.salaId;
            document.getElementById('displayPremio').innerText = `R$ ${(appConfig.valorEntrada * appConfig.qtdParticipantes).toFixed(2)}`;
            document.getElementById('nomeUsuario').innerText = appConfig.usuarioNome;
            document.getElementById('meuAvatar').innerText = appConfig.usuarioNome.substring(0,2).toUpperCase();

            // Gerar Participantes e Gabarito (Mock)
            gerarParticipantesEGabarito();
            renderizarLista();
        }

        function gerarParticipantesEGabarito() {
            estadoJogo.participantes = [];
            
            // Cria lista baseada na quantidade escolhida
            for(let i=0; i < appConfig.qtdParticipantes; i++) {
                estadoJogo.participantes.push({
                    id: i+1,
                    nome: nomesMock[i % nomesMock.length],
                    avatar: avataresMock[i % avataresMock.length]
                });
            }

            // Gera Gabarito: 1->2, 2->3 ... Ultimo->1
            estadoJogo.gabaritoReal = {};
            for(let i=0; i < appConfig.qtdParticipantes; i++) {
                const atual = estadoJogo.participantes[i].id;
                const proximo = (i === appConfig.qtdParticipantes - 1) ? estadoJogo.participantes[0].id : estadoJogo.participantes[i+1].id;
                estadoJogo.gabaritoReal[atual] = proximo;
            }
        }

        // --- L√ìGICA DE JOGO (RENDERIZA√á√ÉO) ---
        function renderizarLista() {
            const container = document.getElementById('lista-participantes');
            container.innerHTML = '';
            
            estadoJogo.participantes.forEach(p => {
                const palpiteId = estadoJogo.palpitesUsuario[p.id];
                const palpitePessoa = palpiteId ? estadoJogo.participantes.find(x => x.id === palpiteId) : null;
                
                // Controle de fase
                const bloqueado = estadoJogo.fase === 'BLOQUEADO' || estadoJogo.fase === 'REVELADO';
                const clickAction = bloqueado ? "alert('Edi√ß√£o bloqueada!')" : `abrirSelecao(${p.id})`;
                const cursor = bloqueado ? 'cursor-not-allowed opacity-60' : 'cursor-pointer hover:bg-white/10';

                container.innerHTML += `
                    <div class="bg-white/5 border border-white/10 rounded-2xl p-3 flex items-center justify-between transition-all">
                        <div class="flex items-center gap-3 w-1/2">
                            <div class="text-2xl bg-indigo-800 w-12 h-12 rounded-full flex items-center justify-center shadow-lg border-2 border-indigo-600">${p.avatar}</div>
                            <span class="font-bold text-gray-200 truncate">${p.nome}</span>
                        </div>
                        <div class="text-gray-500">‚ûú</div>
                        <div onclick="${clickAction}" class="w-1/2 relative group ${cursor}">
                            <div class="${palpitePessoa ? 'bg-green-500/20 border-green-500' : 'bg-dashed border-gray-600'} border-2 border-dashed rounded-xl p-2 flex items-center justify-center gap-2 h-14 transition-all">
                                ${palpitePessoa ? `<span class="text-xl">${palpitePessoa.avatar}</span> <span class="font-bold text-green-400 truncate">${palpitePessoa.nome}</span>` : `<span class="text-2xl text-gray-600">?</span>`}
                            </div>
                        </div>
                    </div>`;
            });
            atualizarBotao();
        }

        function abrirSelecao(id) {
            idSelecionadoAtual = id;
            const grid = document.getElementById('grid-opcoes');
            grid.innerHTML = '';
            estadoJogo.participantes.forEach(p => {
                if (p.id === id) return;
                const isSelected = estadoJogo.palpitesUsuario[idSelecionadoAtual] === p.id;
                grid.innerHTML += `
                    <button onclick="fazerPalpite(${p.id})" class="flex flex-col items-center gap-2 p-2 rounded-xl transition-all ${isSelected ? 'bg-green-600 scale-105' : 'bg-white/10 hover:bg-white/20'}">
                        <span class="text-3xl">${p.avatar}</span>
                        <span class="text-xs font-bold ${isSelected ? 'text-white' : 'text-gray-300'}">${p.nome}</span>
                    </button>`;
            });
            document.getElementById('modal-selecao').classList.remove('hidden');
        }

        function fazerPalpite(id) {
            estadoJogo.palpitesUsuario[idSelecionadoAtual] = id;
            fecharModal();
            renderizarLista();
        }

        function fecharModal() { document.getElementById('modal-selecao').classList.add('hidden'); }

        function atualizarBotao() {
            const faltam = appConfig.qtdParticipantes - Object.keys(estadoJogo.palpitesUsuario).length;
            document.getElementById('contadorPalpites').innerText = faltam;
            const btn = document.getElementById('btnConfirmar');

            if (estadoJogo.fase === 'BLOQUEADO') {
                btn.innerText = "AGUARDANDO REVELA√á√ÉO... ‚è≥";
                btn.className = "w-full bg-gray-500 text-white font-bold py-4 rounded-xl shadow-lg";
                btn.onclick = null;
            } else if (faltam === 0) {
                btn.innerText = "TUDO PRONTO ‚úÖ";
                btn.className = "w-full bg-yellow-400 hover:bg-yellow-300 text-purple-900 font-bold py-4 rounded-xl shadow-lg transition-all text-xl cursor-pointer";
                btn.disabled = false;
                btn.onclick = () => alert("Palpites salvos! Aguarde o organizador liberar o resultado.");
            } else {
                btn.innerText = `Faltam ${faltam} palpites...`;
                btn.className = "w-full bg-gray-700 text-gray-400 font-bold py-4 rounded-xl cursor-not-allowed opacity-80";
                btn.disabled = true;
            }
        }

        function copiarPix() {
            navigator.clipboard.writeText(appConfig.chavePix);
            alert("Chave Pix copiada!");
        }

        // --- SIMULADOR / ADMIN ---
        function mudarFase(novaFase) {
            estadoJogo.fase = novaFase;
            const status = document.getElementById('barra-status');
            
            if(novaFase === 'BLOQUEADO') {
                status.innerHTML = "üîí Palpites Encerrados (1h antes)";
                status.className = "bg-red-500/20 text-red-400 text-center text-sm py-2 rounded-lg mb-4 border border-red-500/30 font-bold";
            } else if (novaFase === 'PALPITES') {
                status.innerHTML = "üü¢ Palpites Liberados";
                status.className = "bg-green-500/20 text-green-400 text-center text-sm py-2 rounded-lg mb-4 border border-green-500/30 font-bold";
            }
            renderizarLista();
        }

        function calcularResultado() {
            estadoJogo.fase = 'REVELADO';
            document.getElementById('tela-jogo').classList.add('hidden');
            document.getElementById('tela-ranking').classList.remove('hidden');
            document.getElementById('painel-admin').classList.add('hidden');

            // 1. Gera Placar (Usu√°rio + Bots)
            let ranking = [];
            
            // Adiciona Usu√°rio
            ranking.push({
                nome: appConfig.usuarioNome + " (Voc√™)",
                avatar: "üë§",
                pontos: calcularPontos(estadoJogo.palpitesUsuario),
                palpites: estadoJogo.palpitesUsuario,
                isUser: true
            });

            // Adiciona Bots para preencher
            for(let i=0; i < appConfig.qtdParticipantes - 1; i++) {
                const palpitesBot = gerarPalpitesAleatorios();
                ranking.push({
                    nome: "Participante " + (i+1),
                    avatar: "ü§ñ",
                    pontos: calcularPontos(palpitesBot),
                    palpites: palpitesBot,
                    isUser: false
                });
            }

            ranking.sort((a,b) => b.pontos - a.pontos);
            exibirRanking(ranking);
        }

        function calcularPontos(palpites) {
            let pts = 0;
            for(const [quem, palpite] of Object.entries(palpites)) {
                if(estadoJogo.gabaritoReal[quem] == palpite) pts++;
            }
            return pts;
        }

        function gerarPalpitesAleatorios() {
            let p = {};
            estadoJogo.participantes.forEach(part => {
                p[part.id] = Math.floor(Math.random() * appConfig.qtdParticipantes) + 1;
            });
            return p;
        }

        function exibirRanking(ranking) {
            // P√≥dio Top 3
            const podio = document.getElementById('podio-area');
            podio.innerHTML = `
                <div class="flex flex-col items-center"><div class="text-3xl mb-1">ü•à</div><div class="bg-gray-400/20 p-2 rounded-t-lg h-24 flex items-end font-bold w-20 justify-center text-sm">${ranking[1]?.nome.split(' ')[0] || '-'}</div></div>
                <div class="flex flex-col items-center -mt-4"><div class="text-4xl mb-1">ü•á</div><div class="bg-yellow-400/20 border-2 border-yellow-400 p-2 rounded-t-lg h-32 flex items-end font-bold text-yellow-400 w-24 justify-center">${ranking[0]?.nome.split(' ')[0] || '-'}</div></div>
                <div class="flex flex-col items-center"><div class="text-3xl mb-1">ü•â</div><div class="bg-orange-700/20 p-2 rounded-t-lg h-16 flex items-end font-bold w-20 justify-center text-sm">${ranking[2]?.nome.split(' ')[0] || '-'}</div></div>
            `;

            // Lista Completa
            const lista = document.getElementById('lista-ranking');
            lista.innerHTML = '';
            ranking.forEach((r, idx) => {
                let htmlDetalhes = '<div class="mt-4 grid grid-cols-1 gap-2 bg-black/20 p-3 rounded-xl">';
                estadoJogo.participantes.forEach(p => {
                    const palpiteFeito = r.palpites[p.id];
                    const correto = estadoJogo.gabaritoReal[p.id];
                    const acertou = palpiteFeito == correto;
                    const nomeChutado = estadoJogo.participantes.find(x=>x.id == palpiteFeito)?.nome || "?";
                    
                    htmlDetalhes += `<div class="flex justify-between text-xs border-b border-white/5 pb-1"><span class="text-gray-400">${p.nome} tirou...</span><span class="${acertou?'text-green-400 font-bold':'text-red-400'}">${nomeChutado} ${acertou?'‚úÖ':'‚ùå'}</span></div>`;
                });
                htmlDetalhes += '</div>';

                lista.innerHTML += `
                    <details class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden group">
                        <summary class="p-4 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="text-gray-500 font-bold w-4">${idx+1}¬∫</div>
                                <div class="text-xl">${r.avatar}</div>
                                <div><div class="font-bold ${r.isUser?'text-yellow-400':'text-gray-200'}">${r.nome}</div></div>
                            </div>
                            <div class="flex items-center gap-3"><span class="font-bold text-xl">${r.pontos}</span><div class="rotate-icon text-gray-500">‚ñº</div></div>
                        </summary>
                        <div class="px-4 pb-4">${htmlDetalhes}</div>
                    </details>
                `;
            });
        }
    </script>
</body>
</html>