<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bol√£o Amigo Secreto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #2D1B4E; color: #F5F5F5; }
        h1, h2, h3, .font-display { font-family: 'Fredoka One', cursive; }
        .page-enter { animation: slideIn 0.4s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .input-dark { width: 100%; padding: 1rem; border-radius: 0.75rem; background-color: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; outline: none; }
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="bg-[#2D1B4E] min-h-screen pb-10">

    <div id="loading" class="fixed inset-0 bg-[#2D1B4E] z-[60] flex items-center justify-center hidden">
        <div class="flex flex-col items-center">
            <div class="animate-spin text-4xl text-yellow-400 mb-4">‚è≥</div>
            <p id="loading-text" class="text-gray-400 text-sm">Carregando...</p>
        </div>
    </div>

    <div id="painel-admin" class="hidden fixed top-0 right-0 p-2 z-50">
        <div class="bg-gray-800 p-2 rounded-lg text-xs shadow-xl border border-gray-600 flex flex-col gap-1">
            <p class="mb-1 text-gray-400 font-bold text-center">ADMIN</p>
            <button id="btnAdminBloquear" class="bg-red-600 px-2 py-1 rounded text-white hover:bg-red-500">Bloquear</button>
            <button id="btnAdminRevelar" class="bg-yellow-600 px-2 py-1 rounded text-white hover:bg-yellow-500">Revelar</button>
        </div>
    </div>

    <div id="tela-home" class="min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <div class="text-center mb-10">
            <div class="inline-block bg-yellow-400 p-5 rounded-full mb-4 shadow-[0_0_30px_rgba(250,204,21,0.4)]">
                <i class="fa-solid fa-gift text-4xl text-purple-900"></i>
            </div>
            <h1 class="text-4xl text-yellow-400 mb-2 font-display">Bol√£o Secreto</h1>
            <p class="text-gray-300">Multiplayer Online</p>
        </div>
        
        <div id="area-reconectar" class="w-full max-w-sm mb-4 hidden">
            <button onclick="reconectarSessao()" class="w-full bg-green-500 hover:bg-green-400 text-white font-bold text-lg py-3 rounded-2xl shadow-lg border border-green-400 flex items-center justify-center gap-2 animate-pulse">
                <i class="fa-solid fa-rotate-right"></i> VOLTAR PARA A SALA
            </button>
            <p class="text-center text-xs text-gray-500 mt-2">Voc√™ j√° estava num jogo.</p>
        </div>

        <div class="w-full max-w-sm space-y-4">
            <button onclick="nav('tela-criar')" class="w-full bg-yellow-400 hover:bg-yellow-300 text-purple-900 font-bold text-xl py-4 rounded-2xl shadow-lg flex items-center justify-center gap-3"><i class="fa-solid fa-plus-circle"></i> CRIAR SALA</button>
            <button onclick="nav('tela-entrar')" class="w-full bg-indigo-800 hover:bg-indigo-700 text-white font-bold text-xl py-4 rounded-2xl shadow-lg border border-indigo-600 flex items-center justify-center gap-3"><i class="fa-solid fa-ticket"></i> ENTRAR</button>
        </div>
    </div>

    <div id="tela-criar" class="hidden min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <h2 class="text-2xl text-yellow-400 font-display mb-6">Criar Sala</h2>
        <div class="w-full max-w-sm bg-white/5 p-6 rounded-3xl border border-white/10 space-y-4">
            <input type="text" id="cNomeEvento" placeholder="Nome do Evento" class="input-dark">
            <input type="text" id="cNomeAdmin" placeholder="Seu Nome (Admin)" class="input-dark">
            <div class="grid grid-cols-2 gap-4">
                <input type="number" id="cQtd" value="5" class="input-dark text-center" placeholder="Pessoas">
                <input type="number" id="cValor" value="10" class="input-dark text-center" placeholder="Valor R$">
            </div>
            <input type="text" id="cPix" placeholder="Chave Pix" class="input-dark">
            <button id="btnCriarFinal" class="w-full bg-green-500 hover:bg-green-400 text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-all">GERAR SALA üé≤</button>
            <button onclick="nav('tela-home')" class="w-full text-gray-400 text-sm py-2 hover:text-white">Voltar</button>
        </div>
    </div>

    <div id="tela-entrar" class="hidden min-h-screen flex flex-col items-center justify-center p-6 page-enter">
        <h2 class="text-2xl text-yellow-400 font-display mb-6">Entrar</h2>
        <div class="w-full max-w-sm bg-white/5 p-6 rounded-3xl border border-white/10 space-y-4">
            <input type="text" id="eCodigo" placeholder="C√≥digo da Sala" class="input-dark text-center uppercase text-2xl tracking-widest font-display">
            <input type="text" id="eNome" placeholder="Seu Nome" class="input-dark">
            <button id="btnEntrarFinal" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl mt-4 shadow-lg active:scale-95 transition-all">ENTRAR üöÄ</button>
            <button onclick="nav('tela-home')" class="w-full text-gray-400 text-sm py-2 hover:text-white">Voltar</button>
        </div>
    </div>

    <div id="tela-jogo" class="hidden max-w-md mx-auto p-4 page-enter">
        <div class="flex justify-between items-center mb-4 mt-2">
            <button onclick="sairDaSala()" class="text-xs text-red-400 border border-red-900 px-3 py-1 rounded-full hover:bg-red-900/50">
                <i class="fa-solid fa-right-from-bracket"></i> Sair
            </button>
            <div class="text-xs text-gray-500">Bol√£o Online</div>
        </div>

        <div class="bg-indigo-900/50 p-4 rounded-2xl mb-4 border border-indigo-500/30 relative overflow-hidden">
            <div class="flex justify-between relative z-10">
                <div>
                    <h3 id="dNomeEvento" class="font-bold text-lg text-white">...</h3>
                    <p class="text-xs text-gray-400 mb-1">C√≥digo da Sala:</p>
                    <div onclick="copiarCodigo()" class="flex items-center gap-2 bg-black/30 px-3 py-1 rounded-lg cursor-pointer hover:bg-black/50 transition-colors w-fit">
                        <span id="dCodigo" class="text-yellow-400 font-display text-xl tracking-wider">...</span>
                        <i class="fa-regular fa-copy text-gray-400 text-xs"></i>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-green-400 font-bold text-xl" id="dPremio">R$ 0</div>
                    <div class="text-[10px] text-gray-400 uppercase">Pr√™mio Total</div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-2 mt-4 relative z-10">
                <button id="btnCompartilhar" class="bg-indigo-600 hover:bg-indigo-500 py-2 rounded-lg text-xs text-white font-bold flex items-center justify-center gap-2 transition-colors">
                    <i class="fa-brands fa-whatsapp text-lg"></i> Convidar
                </button>
                <button id="btnPix" class="bg-gray-700 hover:bg-gray-600 py-2 rounded-lg text-xs text-gray-200 flex items-center justify-center gap-2 transition-colors">
                    <i class="fa-brands fa-pix"></i> Pagar
                </button>
            </div>
        </div>

        <div id="status-bar" class="bg-green-500/20 text-green-400 text-center text-sm py-2 rounded-lg mb-4 font-bold">Carregando...</div>

        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-2">
                <div id="meuAvatar" class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-purple-900 font-bold">EU</div>
                <p id="meuNomeDisplay" class="font-bold text-white">...</p>
            </div>
            <div class="bg-indigo-950 px-3 py-1 rounded-lg border border-indigo-800"><span class="text-gray-400 text-xs">FALTAM: </span><span id="dFaltam" class="text-yellow-400 font-bold">0</span></div>
        </div>

        <div id="lista-participantes" class="space-y-3 pb-24"></div>
    </div>

    <div id="tela-ranking" class="hidden max-w-md mx-auto p-4 page-enter">
        <div class="text-center mb-6 mt-4">
            <h2 class="text-3xl font-display text-yellow-400">Resultado</h2>
        </div>
        <div id="podio-area" class="flex justify-center items-end gap-2 mb-8 h-40"></div>
        <div id="lista-ranking" class="space-y-3 pb-10"></div>
        <div class="grid grid-cols-2 gap-4">
             <button onclick="sairDaSala()" class="w-full py-4 border border-red-500/30 text-red-400 rounded-xl hover:bg-red-900/20">Sair</button>
             <button onclick="location.reload()" class="w-full py-4 border border-white/20 text-gray-400 rounded-xl hover:bg-white/5">Atualizar</button>
        </div>
    </div>

    <div id="modal-selecao" class="fixed inset-0 bg-black/80 hidden z-50 flex items-end justify-center">
        <div class="bg-gray-900 w-full max-w-md rounded-t-3xl p-6 animate-[slideUp_0.3s_ease-out]">
            <div class="flex justify-between mb-4"><h3 class="text-white font-bold">Quem ele(a) tirou?</h3><button onclick="document.getElementById('modal-selecao').classList.add('hidden')" class="text-gray-400 text-xl">&times;</button></div>
            <div id="grid-opcoes" class="grid grid-cols-4 gap-4"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // SUAS CHAVES DO FIREBASE J√Å INSERIDAS:
        const firebaseConfig = {
            apiKey: "AIzaSyBenlc9jAuGq1zsbXuraG40Vzu0bu3PT0g",
            authDomain: "bolao-secreto.firebaseapp.com",
            projectId: "bolao-secreto",
            storageBucket: "bolao-secreto.firebasestorage.app",
            messagingSenderId: "686832695980",
            appId: "1:686832695980:web:d88b70dea07b1e3f08bd09"
        };

        // --- INICIALIZA√á√ÉO ---
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase OK");
        } catch (e) { alert("Erro config Firebase"); }

        // --- VARI√ÅVEIS ---
        let dadosSala = null;
        let meuId = null; 
        let meuNome = null;
        let codigoSala = null;
        let unsubscribe = null; 

        // --- VERIFICA√á√ÉO DE SESS√ÉO (PERSIST√äNCIA) ---
        window.addEventListener('load', () => {
            const sessao = localStorage.getItem('bolao_sessao');
            if(sessao) {
                const dados = JSON.parse(sessao);
                document.getElementById('area-reconectar').classList.remove('hidden');
                // Opcional: Auto-conectar direto (comentei para dar op√ß√£o de voltar)
                // reconectarSessao(); 
            }
        });

        window.reconectarSessao = async () => {
            const sessao = JSON.parse(localStorage.getItem('bolao_sessao'));
            if(sessao && sessao.codigo && sessao.id !== null) {
                mostrarLoading(true, "Reconectando...");
                // Verifica se sala ainda existe
                try {
                    const docSnap = await getDoc(doc(db, "salas", sessao.codigo));
                    if(docSnap.exists()) {
                        entrarNaSala(sessao.codigo, sessao.id, sessao.nome);
                    } else {
                        alert("Essa sala n√£o existe mais.");
                        sairDaSala();
                    }
                } catch(e) {
                    mostrarLoading(false);
                    alert("Erro ao reconectar.");
                }
            }
        };

        window.sairDaSala = () => {
            if(confirm("Deseja sair da sala? Voc√™ precisar√° do c√≥digo para entrar novamente.")) {
                if(unsubscribe) unsubscribe(); // Para de ouvir o firebase
                localStorage.removeItem('bolao_sessao'); // Limpa mem√≥ria
                location.reload(); // Recarrega p√°gina
            }
        };

        // --- NAVEGA√á√ÉO ---
        window.nav = (tela) => {
            document.querySelectorAll('.page-enter').forEach(el => el.classList.add('hidden'));
            document.getElementById(tela).classList.remove('hidden');
        };

        function mostrarLoading(show, text="Carregando...") {
            const el = document.getElementById('loading');
            document.getElementById('loading-text').innerText = text;
            if(show) el.classList.remove('hidden'); else el.classList.add('hidden');
        }

        // --- BOT√ÉO COMPARTILHAR ---
        document.getElementById('btnCompartilhar').addEventListener('click', async () => {
            const url = window.location.href; // Pega o link atual do site
            const textoShare = `üéÅ Bol√£o Amigo Secreto!\nEntra na minha sala: *${codigoSala}*\nAcede aqui: ${url}`;
            
            // Tenta usar a API nativa do telem√≥vel
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Bol√£o Secreto',
                        text: textoShare,
                        url: url
                    });
                } catch (err) { console.log('Cancelado'); }
            } else {
                // Fallback: Copia para clipboard e avisa
                navigator.clipboard.writeText(textoShare);
                alert("Link e convite copiados! Cole no WhatsApp.");
            }
        });

        window.copiarCodigo = () => {
            navigator.clipboard.writeText(codigoSala);
            alert("C√≥digo copiado!");
        }

        // --- CRIAR SALA ---
        document.getElementById('btnCriarFinal').addEventListener('click', async () => {
            const nomeEvento = document.getElementById('cNomeEvento').value;
            const nomeAdmin = document.getElementById('cNomeAdmin').value;
            const qtd = parseInt(document.getElementById('cQtd').value);
            const valor = parseFloat(document.getElementById('cValor').value);
            const pix = document.getElementById('cPix').value;

            if(!nomeEvento || !nomeAdmin || !pix) return alert("Preencha todos os campos!");
            mostrarLoading(true, "Criando sala...");

            const codigo = Math.random().toString(36).substring(2, 8).toUpperCase();
            let gabarito = {};
            for(let i=0; i<qtd; i++) gabarito[i] = (i === qtd-1) ? 0 : i+1;

            try {
                await setDoc(doc(db, "salas", codigo), {
                    admin: nomeAdmin, nomeEvento, qtdMax: qtd, valor, pix,
                    status: "PALPITES", gabarito,
                    participantes: [{ id: 0, nome: nomeAdmin, palpites: {} }]
                });
                entrarNaSala(codigo, 0, nomeAdmin);
            } catch (error) {
                alert("Erro: " + error.message);
                mostrarLoading(false);
            }
        });

        // --- ENTRAR SALA ---
        document.getElementById('btnEntrarFinal').addEventListener('click', async () => {
            const codigo = document.getElementById('eCodigo').value.trim().toUpperCase();
            const nome = document.getElementById('eNome').value.trim();
            if(!codigo || !nome) return alert("Preencha tudo!");
            mostrarLoading(true, "Entrando...");

            const docRef = doc(db, "salas", codigo);
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const dados = docSnap.data();
                    
                    // Verifica se esse nome J√Å existe na sala (Recupera√ß√£o manual)
                    const usuarioExistente = dados.participantes.find(p => p.nome.toUpperCase() === nome.toUpperCase());
                    
                    if(usuarioExistente) {
                        // Se o nome j√° existe, assume que √© a mesma pessoa voltando
                        if(confirm(`J√° existe um "${usuarioExistente.nome}" na sala. √â voc√™?`)) {
                            entrarNaSala(codigo, usuarioExistente.id, usuarioExistente.nome);
                            return;
                        } else {
                            mostrarLoading(false);
                            return alert("Escolha outro nome.");
                        }
                    }

                    if (dados.participantes.length >= dados.qtdMax) {
                        mostrarLoading(false);
                        return alert("Sala lotada!");
                    }
                    
                    const novoId = dados.participantes.length;
                    await updateDoc(docRef, { participantes: arrayUnion({ id: novoId, nome: nome, palpites: {} }) });
                    entrarNaSala(codigo, novoId, nome);
                } else {
                    mostrarLoading(false);
                    alert("Sala n√£o encontrada!");
                }
            } catch(e) { mostrarLoading(false); alert("Erro: " + e.message); }
        });

        // --- L√ìGICA DE JOGO ---
        function entrarNaSala(codigo, id, nome) {
            codigoSala = codigo;
            meuId = id;
            meuNome = nome;

            // SALVAR SESS√ÉO NO NAVEGADOR (LocalStorage)
            localStorage.setItem('bolao_sessao', JSON.stringify({ codigo, id, nome }));

            document.getElementById('dCodigo').innerText = codigo;
            document.getElementById('meuNomeDisplay').innerText = nome;
            mostrarLoading(false);
            window.nav('tela-jogo');

            if(unsubscribe) unsubscribe(); // Limpa listener anterior se houver
            unsubscribe = onSnapshot(doc(db, "salas", codigo), (doc) => {
                if(doc.exists()) {
                    dadosSala = doc.data();
                    atualizarTelaJogo();
                } else {
                    alert("A sala foi encerrada.");
                    sairDaSala();
                }
            });
        }

        function atualizarTelaJogo() {
            document.getElementById('dNomeEvento').innerText = dadosSala.nomeEvento;
            document.getElementById('dPremio').innerText = `R$ ${(dadosSala.valor * dadosSala.participantes.length).toFixed(2)}`;
            
            document.getElementById('btnPix').onclick = () => {
                navigator.clipboard.writeText(dadosSala.pix);
                alert("Chave Pix copiada!");
            };

            const statusDiv = document.getElementById('status-bar');
            const painelAdmin = document.getElementById('painel-admin');
            
            if(meuId === 0) {
                painelAdmin.classList.remove('hidden');
                document.getElementById('btnAdminBloquear').onclick = () => mudarStatus('BLOQUEADO');
                document.getElementById('btnAdminRevelar').onclick = () => mudarStatus('REVELADO');
            }

            if(dadosSala.status === 'PALPITES') {
                statusDiv.innerText = "üü¢ Palpites Liberados";
                statusDiv.className = "bg-green-500/20 text-green-400 text-center text-sm py-2 rounded-lg mb-4 font-bold border border-green-500/30";
            } else if (dadosSala.status === 'BLOQUEADO') {
                statusDiv.innerText = "üîí Bloqueado";
                statusDiv.className = "bg-red-500/20 text-red-400 text-center text-sm py-2 rounded-lg mb-4 font-bold border border-red-500/30";
            } else if (dadosSala.status === 'REVELADO') {
                calcularEExibirRanking();
                return;
            }
            renderizarLista();
        }

        function renderizarLista() {
            const container = document.getElementById('lista-participantes');
            container.innerHTML = '';
            const euParticipante = dadosSala.participantes.find(p => p.id === meuId);
            const meusPalpites = euParticipante ? euParticipante.palpites : {};
            
            // Contador Faltam
            let totalPossivel = Math.max(0, dadosSala.participantes.length - 1);
            let feitos = 0;
            for (const [key, value] of Object.entries(meusPalpites)) {
                if (dadosSala.participantes.some(p => p.id == key)) feitos++;
            }
            document.getElementById('dFaltam').innerText = Math.max(0, totalPossivel - feitos);

            dadosSala.participantes.forEach(p => {
                const palpiteFeitoId = meusPalpites[p.id]; 
                const palpitePessoa = palpiteFeitoId !== undefined ? dadosSala.participantes.find(x => x.id === palpiteFeitoId) : null;
                
                let htmlPalpite = `<span class="text-2xl text-gray-600">?</span>`;
                if(palpitePessoa) htmlPalpite = `<span class="font-bold text-green-400 truncate text-sm">${palpitePessoa.nome}</span>`;

                let clickAttr = '';
                let cursorClass = 'cursor-default opacity-60';
                if(dadosSala.status === 'PALPITES' && p.id !== meuId) {
                     cursorClass = 'cursor-pointer hover:bg-white/10';
                     clickAttr = `data-id="${p.id}"`; 
                }

                container.innerHTML += `
                    <div class="bg-white/5 border border-white/10 rounded-2xl p-3 flex items-center justify-between transition-all">
                        <div class="flex items-center gap-3 w-1/2">
                            <div class="w-8 h-8 bg-indigo-800 rounded-full flex items-center justify-center font-bold text-xs shadow text-white border border-indigo-600">${p.nome.substring(0,2).toUpperCase()}</div>
                            <span class="font-bold text-gray-200 truncate text-sm">${p.nome}</span>
                        </div>
                        <div class="text-gray-500">‚ûú</div>
                        <div class="w-1/2 relative group ${cursorClass} card-palpite" ${clickAttr}>
                            <div class="${palpitePessoa ? 'bg-green-500/20 border-green-500' : 'bg-dashed border-gray-600'} border-2 border-dashed rounded-xl p-2 flex items-center justify-center gap-2 h-12 transition-all">
                                ${htmlPalpite}
                            </div>
                        </div>
                    </div>`;
            });

            document.querySelectorAll('.card-palpite').forEach(el => {
                el.addEventListener('click', () => {
                    const idAlvo = parseInt(el.getAttribute('data-id'));
                    if(!isNaN(idAlvo)) abrirSelecao(idAlvo);
                });
            });
        }

        window.abrirSelecao = (idDeQuemTirou) => {
            const modal = document.getElementById('modal-selecao');
            const grid = document.getElementById('grid-opcoes');
            grid.innerHTML = '';
            dadosSala.participantes.forEach(p => {
                if(p.id === idDeQuemTirou) return; 
                const btn = document.createElement('button');
                btn.className = "flex flex-col items-center gap-2 p-2 rounded-xl bg-white/10 hover:bg-white/20 transition-all active:scale-95";
                btn.innerHTML = `<div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold border-2 border-purple-400 shadow">${p.nome.substring(0,2).toUpperCase()}</div><span class="text-xs font-bold text-gray-300 truncate w-full text-center">${p.nome}</span>`;
                btn.onclick = () => enviarPalpite(idDeQuemTirou, p.id);
                grid.appendChild(btn);
            });
            modal.classList.remove('hidden');
        }

        async function enviarPalpite(quemTirou, palpiteId) {
            document.getElementById('modal-selecao').classList.add('hidden');
            const novaLista = [...dadosSala.participantes];
            const meuIndex = novaLista.findIndex(p => p.id === meuId);
            if(!novaLista[meuIndex].palpites) novaLista[meuIndex].palpites = {};
            novaLista[meuIndex].palpites[quemTirou] = palpiteId;
            try { await updateDoc(doc(db, "salas", codigoSala), { participantes: novaLista }); } catch(e) { alert("Erro ao salvar."); }
        }

        async function mudarStatus(novoStatus) {
            try { await updateDoc(doc(db, "salas", codigoSala), { status: novoStatus }); } catch(e) { alert("Erro status."); }
        }

        function calcularEExibirRanking() {
            window.nav('tela-ranking');
            const container = document.getElementById('lista-ranking');
            const podio = document.getElementById('podio-area');
            container.innerHTML = '';
            let ranking = [];
            
            dadosSala.participantes.forEach(p => {
                let pontos = 0;
                if(p.palpites) {
                    for (const [quem, chute] of Object.entries(p.palpites)) {
                        if(parseInt(chute) === dadosSala.gabarito[quem]) pontos++;
                    }
                }
                ranking.push({ nome: p.nome, pontos: pontos, palpites: p.palpites });
            });
            ranking.sort((a,b) => b.pontos - a.pontos);

            podio.innerHTML = `
                <div class="flex flex-col items-center"><div class="text-3xl mb-1">ü•à</div><div class="bg-gray-400/20 p-2 rounded-t-lg h-24 flex items-end justify-center font-bold w-20 text-sm text-gray-300">${ranking[1]?.nome.split(' ')[0] || '-'}</div></div>
                <div class="flex flex-col items-center -mt-4"><div class="text-4xl mb-1">ü•á</div><div class="bg-yellow-400/20 border-2 border-yellow-400 p-2 rounded-t-lg h-32 flex items-end justify-center font-bold text-yellow-400 w-24 shadow-[0_0_15px_rgba(250,204,21,0.3)]">${ranking[0]?.nome.split(' ')[0] || '-'}</div></div>
                <div class="flex flex-col items-center"><div class="text-3xl mb-1">ü•â</div><div class="bg-orange-700/20 p-2 rounded-t-lg h-16 flex items-end justify-center font-bold w-20 text-sm text-orange-300">${ranking[2]?.nome.split(' ')[0] || '-'}</div></div>
            `;

            ranking.forEach((r, idx) => {
                let htmlDetalhes = '<div class="mt-4 grid grid-cols-1 gap-2 bg-black/20 p-3 rounded-xl">';
                dadosSala.participantes.forEach(p => {
                    const palpiteFeito = r.palpites ? r.palpites[p.id] : undefined;
                    const correto = dadosSala.gabarito[p.id];
                    const acertou = parseInt(palpiteFeito) === correto;
                    const nomeChutado = dadosSala.participantes.find(x=>x.id == palpiteFeito)?.nome || "?";
                    htmlDetalhes += `
                        <div class="flex justify-between text-xs border-b border-white/5 pb-1">
                            <span class="text-gray-400">${p.nome} tirou...</span>
                            <span class="${acertou?'text-green-400 font-bold':'text-red-400'}">${nomeChutado} ${acertou?'‚úÖ':'‚ùå'}</span>
                        </div>`;
                });
                htmlDetalhes += '</div>';

                container.innerHTML += `
                    <details class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden group">
                        <summary class="p-4 flex items-center justify-between hover:bg-white/5 transition-colors">
                            <div class="flex items-center gap-3">
                                <div class="text-gray-500 font-bold w-6 text-center">${idx+1}¬∫</div>
                                <div class="w-8 h-8 bg-indigo-700 rounded-full flex items-center justify-center text-xs font-bold">${r.nome.substring(0,2)}</div>
                                <div class="font-bold text-gray-200">${r.nome}</div>
                            </div>
                            <div class="flex items-center gap-3"><span class="font-bold text-xl text-yellow-400">${r.pontos}</span><div class="text-xs text-gray-500">pts</div></div>
                        </summary>
                        <div class="px-4 pb-4">${htmlDetalhes}</div>
                    </details>
                `;
            });
        }
    </script>
</body>
</html>
